<div class="container is-fluid">

  <ng-container *ngIf="session; else loadingSessionBlock">

    <h1 class="title is-3 has-text-centered">Gruppe {{session.group.name}}, Sitzung {{session.id}}</h1>

    <div class="columns">
      <div class="column is-two-fifths-desktop">
        <div class="box">
          <div class="columns">
            <div class="column is-one-fifth has-text-centered">
              <label for="currentGameIndex" class="label">Spielnummer:</label>
            </div>
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <button class="button" (click)="currentGameIndex = currentGameIndex - 1">-</button>
                </p>
                <p class="control is-expanded">
                  <input type="number" class="input" id="currentGameIndex" [(ngModel)]="currentGameIndex">
                </p>
                <p class="control">
                  <button class="button" (click)="currentGameIndex = currentGameIndex + 1">+</button>
                </p>
              </div>
            </div>
            <div class="column">
              <button class="button is-fullwidth" [ngClass]="{'is-link': isDoubled}" (click)="isDoubled = !isDoubled">
                {{isDoubled ? '&#10004;' : '&#10008; nicht'}} gedoppelt ({{doubledGames}})
              </button>
            </div>
          </div>

          <div class="columns">
            <div class="column is-one-fifth has-text-centered">
              <label class="label">Geber:</label>
            </div>
            <div class="column">
              <button class="button is-fullwidth is-static">{{getDealer().name}}</button>
            </div>
          </div>

          <div class="columns">
            <div class="column has-text-centered">
              <label class="label">Leger:</label>
            </div>
            <div class="column" *ngFor="let pi of playerIndexes">
              <button class="button is-fullwidth" (click)="actingPlayers[pi].hasPut = !actingPlayers[pi].hasPut"
                      [ngClass]="{'is-link': actingPlayers[pi].hasPut}">
                {{actingPlayers[pi].abbreviation}}
              </button>
            </div>
          </div>

          <div class="columns">
            <div class="column has-text-centered">
              <label class="label" [ngClass]="{'has-text-danger': this.submitted && !this.player}">Spieler:</label>
            </div>
            <div class="column" *ngFor="let pi of playerIndexes">
              <button class="button is-fullwidth" (click)="togglePlayer(actingPlayers[pi])"
                      [ngClass]="{'is-link': player === actingPlayers[pi]}">
                {{actingPlayers[pi].abbreviation}}
              </button>
            </div>
          </div>

          <div class="columns">
            <div class="column is-one-fifth has-text-centered">
              <label class="label" [ngClass]="{'has-text-danger': submitted && !playedGameType}">
                Spiel:
              </label>
            </div>

            <div class="column">
              <div class="columns">
                <div class="column is-3" *ngFor="let gameType of allowedGameTypes">
                  <button class="button is-fullwidth" [ngClass]="{'is-link': playedGameType === gameType}"
                          (click)="toggleGameType(gameType)">
                    {{gameType.name}}
                  </button>
                </div>

                <div class="column is-3">
                  <button class="button is-fullwidth" [ngClass]="{'is-link': tout}" (click)="tout = !tout">
                    {{tout ? '&#10004;' : '&#10008; kein'}} Tout
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="columns">
            <div class="column has-text-centered">
              <label class="label"
                     [ngClass]="{'has-text-danger': submitted && playedGameType && playedGameType.needsSuit && !playedGameSuit}">Farbe:</label>
            </div>
            <div class="column" *ngFor="let suit of SuitValues">
              <button class="button is-fullwidth" [ngClass]="{'is-link': playedGameSuit === suit}"
                      [disabled]="!playedGameType || !suitCanBePlayedWithGameType(suit, playedGameType)"
                      (click)="toggleSuit(suit)">
                {{suit.name}}
              </button>
            </div>
          </div>

          <div class="columns">
            <div class="column has-text-centered">
              <label class="label">Kontra/Re:</label>
            </div>
            <div class="column" *ngFor="let kv of KontraValues">
              <button class="button is-fullwidth" (click)="toggleKontraValue(kv)"
                      [ngClass]="{'is-link': kontraValue === kv}">
                {{kv}}
              </button>
            </div>
          </div>

          <div class="columns">
            <div class="column has-text-centered">
              <label class="label" [ngClass]="{'has-text-danger': submitted && getPlayersHavingWonIds().length === 0}">Gewonnen:</label>
            </div>
            <div class="column" *ngFor="let pi of playerIndexes">
              <button class="button is-fullwidth" (click)="actingPlayers[pi].hasWon = !actingPlayers[pi].hasWon"
                      [ngClass]="{'is-link': actingPlayers[pi].hasWon}">
                {{actingPlayers[pi].abbreviation}}
              </button>
            </div>
          </div>

          <div class="columns">
            <div class="column is-one-fifth has-text-centered">
              <label class="label">Schneider / Schwarz:</label>
            </div>
            <div class="column" *ngFor="let snsw of ['Schneider', 'Schwarz']">
              <button class="button is-fullwidth" (click)="toggleSchneiderSchwarz(snsw)"
                      [ngClass]="{'is-link': schneiderSchwarz === snsw}">
                {{snsw}}
              </button>
            </div>
          </div>

          <div class="columns">
            <div class="column is-one-fifth has-text-centered">
              <label for="laufendeCount" class="label">Laufende:</label>
            </div>
            <div class="column">
              <div class="field has-addons">
                <p class="control">
                  <button class="button" (click)="laufendeCount  = laufendeCount - 1">-</button>
                </p>
                <p class="control is-expanded">
                  <input type="number" class="input" id="laufendeCount" [(ngModel)]="laufendeCount">
                </p>
                <p class="control">
                  <button class="button" (click)="laufendeCount  = laufendeCount  + 1">+</button>
                </p>
              </div>
            </div>
          </div>

          <div class="columns">
            <div class="column">
              <button class="button is-warning is-fullwidth" (click)="throwIn()">Zusammenschmiss</button>
            </div>
            <div class="column">
              <button class="button is-link is-fullwidth" (click)="saveGame()">Spiel eintragen</button>
            </div>
          </div>

        </div>
      </div>

      <div class="column">
        <div class="box" *ngIf="session.playedGames && session.playedGames.length > 0">
          <skl-games-table [session]="session"></skl-games-table>
        </div>
      </div>
    </div>

  </ng-container>

</div>

<ng-template #loadingSessionBlock>
  <div class="notification is-primary has-text-centered">Lade Sitzung...</div>
</ng-template>
