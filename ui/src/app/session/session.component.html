<div class="container">

  <ng-container *ngIf="session; else loadingSessionBlock">

    <h1 class="title is-3 has-text-centered">Gruppe {{session.group.name}}, Sitzung {{session.id}},
      Spiel {{currentGameIndex}}</h1>


    <div class="box" *ngIf="session.playedGames && session.playedGames.length > 0">
      <skl-games-table [session]="session"></skl-games-table>
    </div>

    <br>

    <div class="columns">
      <div class="column" *ngFor="let p of actingPlayers; let index = index">
        <div class="card">
          <header class="card-header">
            <p class="card-header-title is-centered">
              <span [ngClass]="isDealer(index) ? 'is-uppercase' : ''">{{p.name}}</span>
              {{isDealer(index) ? '&nbsp;(Geber)' : ''}}
            </p>
          </header>
          <div class="card-content">

            <div class="buttons">
              <button class="button is-fullwidth" [ngClass]="p.hasPut ? 'is-link' : ''" (click)="p.hasPut = !p.hasPut">
                {{p.hasPut ? '&#10004;' : '&#10008; nicht'}} gelegt
              </button>

              <button (click)="togglePlayer(p)" class="button is-fullwidth" [ngClass]="player === p ? 'is-link' : ''">
                {{player === p ? '&#10004; spielt' : '&#10008; spielt nicht'}}
              </button>

              <button class="button is-fullwidth" [ngClass]="p.gaveContra ? 'is-link' : ''"
                      (click)="p.gaveContra = !p.gaveContra">
                {{p.gaveContra ? '&#10004;' : '&#10008; kein'}} Kontra / Re
              </button>

              <button (click)="p.hasWon = !p.hasWon" class="button is-fullwidth" [ngClass]="p.hasWon ? 'is-link' : ''">
                {{p.hasWon ? '&#10004; gewonnen' : '&#10008; verloren'}}
              </button>
            </div>

          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <header class="card-header">
        <p class="card-header-title">Spielansage und -ergebnis</p>
      </header>
      <div class="card-content">

        <skl-button-list-select
          label="Angesagtes Spiel:"
          [options]="allowedGameTypes"
          (selected)="toggleGameType($event)">
        </skl-button-list-select>

        <br>

        <skl-button-list-select
          label="Farbe:"
          [options]="allowedSuits"
          (selected)="toggleSuit($event)"
          [allDisabled]="!playedGameType || !playedGameType.needsSuit">
        </skl-button-list-select>

        <br>

        <div class="field is-horizontal">
          <div class="field-label">
            <label class="label">Tout:</label>
          </div>
          <div class="field-body">
            <div class="field">
              <div class="control">
                <div class="buttons">
                  <button class="button is-fullwidth" [ngClass]="tout ? 'is-link': ''"
                          [disabled]="!playedGameType || !playedGameType.canBeTout">
                    {{tout ? '&#10004;' : '&#10008; kein'}} Tout
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <br>

        <skl-button-list-select
          label="Schneider / Schwarz:"
          [options]="schneiderSchwarzValues"
          (selected)="toggleSchneiderSchwarz($event)">
        </skl-button-list-select>

        <hr>

        <div class="buttons">
          <button class="button is-link is-fullwidth" (click)="saveGame()">Spiel eintragen</button>
        </div>

      </div>
    </div>

  </ng-container>

</div>

<ng-template #loadingSessionBlock>
  <div class="notification is-primary has-text-centered">Lade Sitzung...</div>
</ng-template>

<ng-template #noSessionFoundBlock>
  <div class="notification is-danger has-text-centered">Keine Sitzung gefunden!</div>
</ng-template>
